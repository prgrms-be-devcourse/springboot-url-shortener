<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>데브유니 단축 URL 생성기</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
</head>
<body>
<div class="container" style="margin-top: 10rem;">
    <figure class="text-center">
        <blockquote class="blockquote">
            <p class="fs-1 fw-bold">Dev Uni, Shorten Url Generator</p>
        </blockquote>
        <figcaption class="blockquote-footer fs-4">
            긴 Url을 단축시켜, 편하게 공유해보세요.
        </figcaption>
    </figure>
</div>
<div class="container mt-5 align-self-center" style="width: 50rem;">
    <div class="card">
        <div class="card-body">
            <form class="row g-3">
                <div class="col">
                    <input type="text" class="form-control" id="shorten-url" placeholder="줄이고 싶은 URL을 입력하세요.">
                </div>
                <div class="col-auto">
                    <button type="button" onclick="shortenUrl()" class="btn btn-secondary mb-3">단축하기</button>
                </div>
            </form>
        </div>
    </div>
    <div class="card mt-2">
        <div class="card-body">
            <div class="card-body">
                <p class="card-text">단축 URL : <span><a id='top-short-url' href=""></a></span></p>
                <p class="card-text">원래 URL : <span><a id='top-origin-url'></a></span></p>
                <h6 class="card-title">요청 조회수 : <a id="top-request-count"></a></h6>
            </div>
        </div>
    </div>
    <div class="card mt-5">
        <div class="card-body">
            <form class="row g-3">
                <div class="col">
                    <input type="text" class="form-control" id="find-origin" placeholder="확인하고 싶은 단축 URL을 입력하세요.">
                </div>
                <div class="col-auto">
                    <button type="button" onclick="originUrl()" class="btn btn-secondary mb-3">조회하기</button>
                </div>
            </form>
        </div>
    </div>
    <div class="card mt-2">
        <div class="card-body">
            <div class="card-body">
                <p class="card-text">원래 URL : <span><a id='bottom-origin-url'></a></span></p>
            </div>
        </div>
    </div>
</div>
<script>
    const host = "http://localhost:8080"
    const protocol = "https://www."

    const shortenUrl = () => {

        const originUrl = document.getElementById("shorten-url").value;

        axios
            .post(`${host}/shorten`, {
                originUrl: originUrl
            },)
            .then((res) => {
                if (res.status === 201) {
                    const topShortUrl = document.getElementById("top-short-url");
                    const topOriginUrl = document.getElementById("top-origin-url");
                    const topRequestCount = document.getElementById("top-request-count");
                    const data = res.data

                    topShortUrl.innerHTML = `<a href="${host + "/" + data.shortUrlKey}">${host + "/" + data.shortUrlKey}</a>`;
                    topOriginUrl.innerHTML = `<a href="${protocol + data.originUrl}" target="_blank">${protocol + data.originUrl}</a>`;
                    topRequestCount.textContent = data.requestCount;
                    alert('URL 단축이 정상적으로 처리되었습니다.')
                }
            })
            .catch((error) => {
                if (error.response && error.response.status === 400) {
                    const {validation} = error.response.data;
                    const errorMessages = Object.values(validation).join('\n');
                    alert(errorMessages);
                } else {
                    console.log('Error:', error);
                    alert('URL 단축 중 오류가 발생했습니다.');
                }
            });
    };

    const originUrl = () => {
        const findOrigin = document.getElementById("find-origin").value;
        console.log(findOrigin)

        axios.get(`${host}/shorten?shortUrl=${findOrigin}`)
            .then(res => {
                if (res.status === 200) {
                    const bottomOriginUrl = document.getElementById("bottom-origin-url");
                    const data = res.data

                    bottomOriginUrl.innerHTML = `<a href="${data}" target="_blank">${data}</a>`;
                    alert('단축 URL 조회가 성공하였습니다.')
                }
            })
            .catch((error) => {
                if (error.response && error.response.status === 400) {
                    const {validation} = error.response.data;
                    const errorMessages = Object.values(validation).join('\n');
                    alert(errorMessages);
                } else {
                    console.log('Error:', error);
                    alert('단축 URL 조회 중 오류가 발생했습니다.');
                }
            });
    }

</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm"
        crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
</body>
</html>
